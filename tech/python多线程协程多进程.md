## 多线程、协程、多进程

1. 进程是一个实体。每个进程都有自己的地址空间(CPU分配)。实体空间包括三部分
   - 文本区域：存储处理器执行的代码。
   - 数据区域：存储变量或进程执行期间使用的动态分配的内存。
   - 堆栈：进程执行时调用的指令和本地变量。

2. 进程是一个“执行中的程序”,每个线程有一个程序运行的入口、顺序执行序列和程序的出口。但是线程不能够独立执行，必须依存在进程中，由进程提供多个线程执行控制。每个线程都有他自己的一组CPU寄存器，称为线程的上下文，该上下文反映了线程上次运行该线程的CPU寄存器的状态。
>进程的特点
>- 动态性：进程是程序的一次执行过程，动态产生，动态消亡。
>- 独立性：进程是一个能独立运行的基本单元。是系统分配资源与调度的基本单元。
>- 并发性：任何进程都可以与其他进程并发执行。

3. 协程，又称微线程，Coroutine。执行过程中，在子程序内部可中断，然后转而执行别的子程序，在适当的时候再返回来接着执行。实际上就是对函数调用流程的一种控制方式，让函数互相协作配合，这就是协程


## 区别
- 进程是重量级别的程序，创建和销毁的开销大
- 线程是轻量级别的程序，开销相对较小，切换速度较快
- 协程更轻量，但是由程序内部负责调度，复杂度更高

>CPython解释器本身不是线程安全的，因此需要全局解释器锁GIL，一次只允许一个线程执行Python字节码。因此一个Python进程不能同时使用到多个CPU核心。
然而，标准库中所有执行阻塞型 IO 操作的函数，在等待结果返回时都会释放GIL。这意味着尽管有GIL，Python线程还是能在 IO 密集型任务中一展身手。

## 最佳实践

- 线程和协程推荐在**IO密集型**的任务(比如网络调用)中使用，而在CPU密集型的任务中，表现较差。

- 对于CPU密集型的任务，则需要多个进程，**绕开GIL的限制**，利用所有可用的CPU核心，提高效率。

- 所以**大并发**下的最佳实践就是**多进程+协程**，既充分利用多核，又充分发挥协程的高效率，可获得极高的性能。



